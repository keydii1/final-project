extends ../../layouts/default.pug
include ../../mixins/fillerStatus.pug
include ../../mixins/search.pug
include ../../mixins/pagination.pug
include ../../mixins/form-change-multi.pug
include ../../mixins/alert.pug
include ../../mixins/sort.pug

block main
  +alert-success("2000")

  .container.mt-4
    h2.mb-4 Danh sách sản phẩm

    // --- Bộ lọc và Tìm kiếm ---
    .mb-3
      +search(keyword)

    +fillerStatus(fillterStatus)

    .row.mb-3
      .col-8
        +form-change-multi(`${prefixAdmin}/products/change-multi?_method=PATCH`)
      .col-4
        a(
          href=`${prefixAdmin}/products/create`
          class="btn btn-success float-right"
        ) Thêm sản phẩm

    // --- Sắp xếp ---
    +sort()
    // --- Bảng danh sách sản phẩm ---
    table.table.table-bordered.table-striped(checkbox-multi)
      thead
        tr
          th
            input(type="checkbox" name="checkall")
          th STT
          th Hình ảnh
          th Tiêu đề
          th Giá
          th Vị trí
          th Trạng thái
          th Hành động
      tbody
        each item, index in products
          tr
            td
              input(
                type="checkbox"
                name="id"
                value=item.id
              )
            td #{pagination.limitItems*(pagination.currentPage-1)+index+1}
            td
              if item.thumbnail
                img(src=item.thumbnail, alt="Sản phẩm", width="100", height="auto")
              else
                span.text-muted Không có ảnh
            td #{item.title}
            td #{item.price}$
            td
              input(
                type="number"
                name="position"
                value=item.position
                class="form-control"
                style="width: 80px; text-align: center"
              )
            td
              if item.status == 'active'
                a(
                  href="javascript:;"
                  data-status="active"
                  data-id=item.id
                  button-change-status
                  class="badge badge-success"
                ) Hoạt động
              else
                a(
                  href="javascript:;"
                  data-status="inactive"
                  data-id=item.id
                  button-change-status
                  class="badge badge-danger"
                ) Dừng hoạt động
            td
              a(
                href=`${prefixAdmin}/products/detail/${item.id}`
                class="btn btn-info btn-sm mr-1"
              ) Chi tiết
              a(
                href=`${prefixAdmin}/products/edit/${item.id}`
                class="btn btn-warning btn-sm"
              ) Sửa
              button(
                class="btn btn-danger btn-sm ml-1"
                data-id=item.id
                button-delete
              ) Xoá

    // --- Phân trang ---
    +paginationMixin(pagination)

    // --- Form ẩn ---
    form(
      action=""
      method="POST"
      id="form-change-status"
      data-path=`${prefixAdmin}/products/change-status`
    )
    form(
      action=""
      method="POST"
      id="form-delete-item"
      data-path=`${prefixAdmin}/products/delete`
    )

    script(src="/admin/js/products.js")
